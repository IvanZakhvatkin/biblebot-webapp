<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ë–∏–±–ª–∏—è –æ–Ω–ª–∞–π–Ω</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üìñ –ß—Ç–µ–Ω–∏–µ –ë–∏–±–ª–∏–∏</h1>
  <div id="text" style="margin-top:2em;"></div>
  <script>
    // ---- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ----
    const API_BASE = "http://147.45.163.133:8000";

    // ---- –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL ----
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        book: params.get("book"),
        chapter: params.get("chapter")
      };
    }

    // ---- –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤—É ----
    function showChapter(book, chapter) {
      const textDiv = document.getElementById("text");
      textDiv.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      fetch(`${API_BASE}/bible?book=${encodeURIComponent(book)}&chapter=${encodeURIComponent(chapter)}`)
        .then((res) => {
          if (!res.ok) throw new Error("–ì–ª–∞–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
          return res.json();
        })
        .then((data) => {
          if (!data.verses || !data.verses.length) {
            textDiv.innerHTML = "–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–π –≥–ª–∞–≤—ã";
            return;
          }
          // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥–ª–∞–≤—ã
          let html = `<h2>${data.book}, ${data.chapter}</h2>`;
          html += data.verses.map(
            (v) => `<p><strong>${v.verse}</strong> ${v.text}</p>`
          ).join("");
          textDiv.innerHTML = html;
        })
        .catch((err) => {
          textDiv.innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤—ã";
        });
    }

    // ---- –ó–∞–ø—É—Å–∫ ----
    window.onload = function() {
      const { book, chapter } = getUrlParams();
      if (book && chapter) {
        showChapter(book, chapter.startsWith("–ì–ª–∞–≤–∞ ") ? chapter : "–ì–ª–∞–≤–∞ " + chapter);
      } else {
        document.getElementById("text").innerHTML = "–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥–ª–∞–≤—ã –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –±–æ—Ç–∞.";
      }
    };
  </script>
</body>
</html>
